import type { AchievementLevel } from "./store"

export interface Badge {
  id: string
  name: string
  description: string
  icon: string
  level: AchievementLevel
  requirements: {
    type: "achievements" | "projects" | "languages" | "frameworks" | "combination" | "streak"
    count?: number
    specificIds?: string[]
    languages?: string[]
    frameworks?: string[]
    projectCount?: number
    streakDays?: number
    description: string
  }
}

// Define badges that are more challenging than regular achievements
export const badges: Badge[] = [
  // Student Level Badges
  {
    id: "student-explorer",
    name: "Explorador Novato",
    description: "Completa una variedad de proyectos de nivel Student",
    icon: "üîç",
    level: "Student",
    requirements: {
      type: "projects",
      projectCount: 5,
      description: "Completa 5 proyectos de nivel Student en al menos 2 lenguajes diferentes.",
    },
  },
  {
    id: "student-dedication",
    name: "Dedicaci√≥n Estudiantil",
    description: "Muestra constancia en tu aprendizaje inicial",
    icon: "üìö",
    level: "Student",
    requirements: {
      type: "streak",
      streakDays: 3,
      description: "Completa al menos un proyecto cada d√≠a durante 3 d√≠as consecutivos.",
    },
  },
  {
    id: "student-polyglot",
    name: "Pol√≠glota Principiante",
    description: "Experimenta con diferentes lenguajes de programaci√≥n",
    icon: "üó£Ô∏è",
    level: "Student",
    requirements: {
      type: "languages",
      count: 3,
      description: "Completa proyectos en 3 lenguajes de programaci√≥n diferentes.",
    },
  },
  {
    id: "student-web-pioneer",
    name: "Pionero Web",
    description: "Primeros pasos en el desarrollo web",
    icon: "üåê",
    level: "Student",
    requirements: {
      type: "combination",
      languages: ["HTML", "CSS", "JavaScript"],
      count: 2,
      description: "Completa proyectos utilizando al menos 2 de estos lenguajes: HTML, CSS y JavaScript.",
    },
  },
  {
    id: "student-algorithm-master",
    name: "Maestro de Algoritmos B√°sicos",
    description: "Dominio de algoritmos fundamentales",
    icon: "üßÆ",
    level: "Student",
    requirements: {
      type: "projects",
      projectCount: 3,
      description: "Completa 3 proyectos enfocados en algoritmos b√°sicos.",
    },
  },
  {
    id: "student-mobile-explorer",
    name: "Explorador M√≥vil",
    description: "Primeros pasos en el desarrollo m√≥vil",
    icon: "üì±",
    level: "Student",
    requirements: {
      type: "combination",
      frameworks: ["React Native", "Flutter"],
      count: 1,
      description: "Completa un proyecto utilizando React Native o Flutter.",
    },
  },
  {
    id: "student-game-developer",
    name: "Desarrollador de Juegos Novato",
    description: "Creaci√≥n de juegos simples",
    icon: "üéÆ",
    level: "Student",
    requirements: {
      type: "projects",
      projectCount: 2,
      description: "Completa 2 proyectos de juegos simples.",
    },
  },
  {
    id: "student-database-initiate",
    name: "Iniciado en Bases de Datos",
    description: "Primeros pasos con bases de datos",
    icon: "üíæ",
    level: "Student",
    requirements: {
      type: "combination",
      frameworks: ["MySQL", "MongoDB", "SQLite"],
      count: 1,
      description: "Completa un proyecto utilizando una base de datos.",
    },
  },

  // Trainee Level Badges
  {
    id: "trainee-specialist",
    name: "Especialista en Formaci√≥n",
    description: "Domina un lenguaje espec√≠fico a nivel Trainee",
    icon: "üõ†Ô∏è",
    level: "Trainee",
    requirements: {
      type: "combination",
      languages: ["JavaScript", "Python", "Java"],
      projectCount: 5,
      description: "Completa 5 proyectos en uno de estos lenguajes: JavaScript, Python o Java.",
    },
  },
  {
    id: "trainee-framework-explorer",
    name: "Explorador de Frameworks",
    description: "Experimenta con diferentes frameworks",
    icon: "üß©",
    level: "Trainee",
    requirements: {
      type: "frameworks",
      count: 2,
      description: "Completa proyectos usando 2 frameworks diferentes.",
    },
  },
  {
    id: "trainee-consistency",
    name: "Consistencia en Desarrollo",
    description: "Mant√©n un ritmo constante de aprendizaje",
    icon: "üìÖ",
    level: "Trainee",
    requirements: {
      type: "combination",
      projectCount: 8,
      streakDays: 5,
      description: "Completa 8 proyectos y mant√©n una racha de 5 d√≠as.",
    },
  },
  {
    id: "trainee-api-master",
    name: "Maestro de APIs",
    description: "Dominio en la integraci√≥n de APIs",
    icon: "üîå",
    level: "Trainee",
    requirements: {
      type: "projects",
      projectCount: 3,
      description: "Completa 3 proyectos que integren APIs externas.",
    },
  },
  {
    id: "trainee-responsive-designer",
    name: "Dise√±ador Responsivo",
    description: "Especialista en dise√±o web adaptable",
    icon: "üìê",
    level: "Trainee",
    requirements: {
      type: "projects",
      projectCount: 3,
      description: "Completa 3 proyectos con dise√±o responsivo avanzado.",
    },
  },
  {
    id: "trainee-testing-pioneer",
    name: "Pionero en Testing",
    description: "Implementaci√≥n de pruebas en proyectos",
    icon: "üß™",
    level: "Trainee",
    requirements: {
      type: "projects",
      projectCount: 2,
      description: "Completa 2 proyectos que incluyan pruebas unitarias o de integraci√≥n.",
    },
  },
  {
    id: "trainee-database-architect",
    name: "Arquitecto de Bases de Datos",
    description: "Dise√±o avanzado de bases de datos",
    icon: "üóÑÔ∏è",
    level: "Trainee",
    requirements: {
      type: "combination",
      frameworks: ["MySQL", "PostgreSQL", "MongoDB", "Firebase"],
      count: 2,
      description: "Completa proyectos utilizando 2 sistemas de bases de datos diferentes.",
    },
  },
  {
    id: "trainee-ui-specialist",
    name: "Especialista en UI",
    description: "Creaci√≥n de interfaces de usuario atractivas",
    icon: "üé®",
    level: "Trainee",
    requirements: {
      type: "projects",
      projectCount: 3,
      description: "Completa 3 proyectos con enfoque en UI/UX avanzado.",
    },
  },

  // Junior Level Badges
  {
    id: "junior-fullstack",
    name: "Desarrollador Fullstack Junior",
    description: "Domina tanto frontend como backend",
    icon: "‚öôÔ∏è",
    level: "Junior",
    requirements: {
      type: "projects",
      projectCount: 5,
      description: "Completa 5 proyectos que combinen frontend y backend.",
    },
  },
  {
    id: "junior-database-master",
    name: "Maestro de Bases de Datos",
    description: "Experiencia con m√∫ltiples sistemas de bases de datos",
    icon: "üíæ",
    level: "Junior",
    requirements: {
      type: "frameworks",
      count: 3,
      description: "Utiliza 3 sistemas de bases de datos diferentes en tus proyectos.",
    },
  },
  {
    id: "junior-project-marathon",
    name: "Marat√≥n de Proyectos",
    description: "Completa una gran cantidad de proyectos variados",
    icon: "üèÉ",
    level: "Junior",
    requirements: {
      type: "projects",
      projectCount: 15,
      description: "Completa 15 proyectos en total, incluyendo al menos 5 de nivel Junior o superior.",
    },
  },
  {
    id: "junior-cloud-architect",
    name: "Arquitecto Cloud",
    description: "Especialista en soluciones en la nube",
    icon: "‚òÅÔ∏è",
    level: "Junior",
    requirements: {
      type: "combination",
      frameworks: ["AWS", "Azure", "Google Cloud", "Firebase"],
      count: 1,
      description: "Completa proyectos utilizando al menos una plataforma cloud.",
    },
  },
  {
    id: "junior-security-specialist",
    name: "Especialista en Seguridad",
    description: "Implementaci√≥n de medidas de seguridad avanzadas",
    icon: "üîí",
    level: "Junior",
    requirements: {
      type: "projects",
      projectCount: 2,
      description: "Completa 2 proyectos con enfoque en seguridad inform√°tica.",
    },
  },
  {
    id: "junior-performance-optimizer",
    name: "Optimizador de Rendimiento",
    description: "Mejora del rendimiento en aplicaciones",
    icon: "‚ö°",
    level: "Junior",
    requirements: {
      type: "projects",
      projectCount: 3,
      description: "Completa 3 proyectos con optimizaci√≥n avanzada de rendimiento.",
    },
  },
  {
    id: "junior-mobile-master",
    name: "Maestro M√≥vil",
    description: "Desarrollo avanzado de aplicaciones m√≥viles",
    icon: "üì≤",
    level: "Junior",
    requirements: {
      type: "combination",
      frameworks: ["React Native", "Flutter", "Swift", "Kotlin"],
      count: 2,
      description: "Completa proyectos utilizando 2 frameworks m√≥viles diferentes.",
    },
  },
  {
    id: "junior-devops-pioneer",
    name: "Pionero DevOps",
    description: "Implementaci√≥n de pr√°cticas DevOps",
    icon: "üîÑ",
    level: "Junior",
    requirements: {
      type: "projects",
      projectCount: 2,
      description: "Completa 2 proyectos que implementen CI/CD o pr√°cticas DevOps.",
    },
  },

  // Senior Level Badges
  {
    id: "senior-tech-diversity",
    name: "Diversidad Tecnol√≥gica",
    description: "Dominio de m√∫ltiples tecnolog√≠as a nivel avanzado",
    icon: "üåê",
    level: "Senior",
    requirements: {
      type: "combination",
      languages: ["JavaScript", "Python", "Java", "C#", "Go", "Rust"],
      count: 3,
      projectCount: 3,
      description: "Completa al menos 3 proyectos en cada uno de 3 lenguajes diferentes de nivel Senior.",
    },
  },
  {
    id: "senior-architecture",
    name: "Arquitecto de Software",
    description: "Experiencia en dise√±o de sistemas complejos",
    icon: "üèõÔ∏è",
    level: "Senior",
    requirements: {
      type: "projects",
      projectCount: 5,
      description: "Completa 5 proyectos de arquitectura de software complejos.",
    },
  },
  {
    id: "senior-mentor",
    name: "Mentor Tecnol√≥gico",
    description: "Dominio completo de m√∫ltiples niveles de desarrollo",
    icon: "üë®‚Äçüè´",
    level: "Senior",
    requirements: {
      type: "projects",
      projectCount: 20,
      description: "Completa 20 proyectos de diferentes niveles de dificultad.",
    },
  },
  {
    id: "senior-microservices-architect",
    name: "Arquitecto de Microservicios",
    description: "Dise√±o e implementaci√≥n de arquitecturas de microservicios",
    icon: "üß±",
    level: "Senior",
    requirements: {
      type: "projects",
      projectCount: 2,
      description: "Completa 2 proyectos basados en arquitectura de microservicios.",
    },
  },
  {
    id: "senior-ai-specialist",
    name: "Especialista en IA",
    description: "Implementaci√≥n de soluciones de inteligencia artificial",
    icon: "ü§ñ",
    level: "Senior",
    requirements: {
      type: "projects",
      projectCount: 3,
      description: "Completa 3 proyectos que implementen algoritmos de IA o machine learning.",
    },
  },
  {
    id: "senior-scalability-expert",
    name: "Experto en Escalabilidad",
    description: "Dise√±o de sistemas altamente escalables",
    icon: "üìà",
    level: "Senior",
    requirements: {
      type: "projects",
      projectCount: 2,
      description: "Completa 2 proyectos con arquitecturas escalables para alto tr√°fico.",
    },
  },
  {
    id: "senior-security-architect",
    name: "Arquitecto de Seguridad",
    description: "Dise√±o de sistemas con seguridad avanzada",
    icon: "üõ°Ô∏è",
    level: "Senior",
    requirements: {
      type: "projects",
      projectCount: 3,
      description: "Completa 3 proyectos con enfoque en ciberseguridad avanzada.",
    },
  },
  {
    id: "senior-blockchain-pioneer",
    name: "Pionero en Blockchain",
    description: "Desarrollo de soluciones basadas en blockchain",
    icon: "‚õìÔ∏è",
    level: "Senior",
    requirements: {
      type: "projects",
      projectCount: 2,
      description: "Completa 2 proyectos que implementen tecnolog√≠as blockchain.",
    },
  },

  // Master Level Badges
  {
    id: "master-polyglot",
    name: "Maestro Pol√≠glota",
    description: "Dominio excepcional de m√∫ltiples lenguajes de programaci√≥n",
    icon: "üåç",
    level: "Master",
    requirements: {
      type: "languages",
      count: 6,
      description:
        "Completa proyectos en 6 lenguajes de programaci√≥n diferentes, con al menos 3 proyectos en cada uno.",
    },
  },
  {
    id: "master-dedication",
    name: "Dedicaci√≥n Legendaria",
    description: "Compromiso extraordinario con el desarrollo de software",
    icon: "‚è∞",
    level: "Master",
    requirements: {
      type: "combination",
      projectCount: 50,
      streakDays: 15,
      description: "Completa 50 proyectos en total y mant√©n una racha de 15 d√≠as consecutivos.",
    },
  },
  {
    id: "master-completionist",
    name: "Completista Supremo",
    description: "Dominio completo de todos los aspectos del desarrollo",
    icon: "üëë",
    level: "Master",
    requirements: {
      type: "projects",
      projectCount: 30,
      description: "Completa 30 proyectos de diferentes categor√≠as y niveles.",
    },
  },
  {
    id: "master-innovation-leader",
    name: "L√≠der en Innovaci√≥n",
    description: "Creaci√≥n de soluciones tecnol√≥gicas innovadoras",
    icon: "üí°",
    level: "Master",
    requirements: {
      type: "projects",
      projectCount: 5,
      description: "Completa 5 proyectos que implementen tecnolog√≠as emergentes o soluciones innovadoras.",
    },
  },
  {
    id: "master-system-architect",
    name: "Arquitecto de Sistemas",
    description: "Dise√±o de arquitecturas de sistemas complejos",
    icon: "üèóÔ∏è",
    level: "Master",
    requirements: {
      type: "projects",
      projectCount: 10,
      description: "Completa 10 proyectos de arquitectura de sistemas complejos.",
    },
  },
  {
    id: "master-tech-visionary",
    name: "Visionario Tecnol√≥gico",
    description: "Anticipaci√≥n y adopci√≥n de tendencias tecnol√≥gicas",
    icon: "üîÆ",
    level: "Master",
    requirements: {
      type: "projects",
      projectCount: 10,
      description: "Completa 10 proyectos con tecnolog√≠as emergentes.",
    },
  },
  {
    id: "master-security-guru",
    name: "Gur√∫ de Seguridad",
    description: "M√°xima autoridad en seguridad inform√°tica",
    icon: "üîê",
    level: "Master",
    requirements: {
      type: "projects",
      projectCount: 5,
      description: "Completa 5 proyectos enfocados en seguridad avanzada.",
    },
  },
  {
    id: "master-performance-wizard",
    name: "Mago del Rendimiento",
    description: "Optimizaci√≥n extrema de rendimiento en sistemas",
    icon: "‚ö°",
    level: "Master",
    requirements: {
      type: "projects",
      projectCount: 8,
      description: "Completa 8 proyectos con optimizaciones avanzadas de rendimiento.",
    },
  },
  {
    id: "master-tech-evangelist",
    name: "Evangelista Tecnol√≥gico",
    description: "Promoci√≥n y difusi√≥n de buenas pr√°cticas en desarrollo",
    icon: "üì¢",
    level: "Master",
    requirements: {
      type: "combination",
      projectCount: 25,
      streakDays: 20,
      description: "Completa 25 proyectos y mant√©n una racha de 20 d√≠as.",
    },
  },

  // Brainfuck Badges
  {
    id: "brainfuck-initiate",
    name: "Iniciado en Brainfuck",
    description: "Primeros pasos en el enigm√°tico lenguaje Brainfuck",
    icon: "üß†",
    level: "Student",
    requirements: {
      type: "combination",
      languages: ["Brainfuck"],
      projectCount: 1,
      description: "Completa tu primer proyecto en Brainfuck.",
    },
  },
  {
    id: "brainfuck-explorer",
    name: "Explorador de Brainfuck",
    description: "Aventur√°ndote m√°s profundamente en Brainfuck",
    icon: "üîç",
    level: "Trainee",
    requirements: {
      type: "combination",
      languages: ["Brainfuck"],
      projectCount: 3,
      description: "Completa 3 proyectos en Brainfuck.",
    },
  },
  {
    id: "brainfuck-enthusiast",
    name: "Entusiasta de Brainfuck",
    description: "Desarrollando habilidades s√≥lidas en Brainfuck",
    icon: "üí≠",
    level: "Junior",
    requirements: {
      type: "combination",
      languages: ["Brainfuck"],
      projectCount: 5,
      description: "Completa 5 proyectos en Brainfuck.",
    },
  },
  {
    id: "brainfuck-master",
    name: "Maestro de Brainfuck",
    description: "Dominio avanzado del lenguaje Brainfuck",
    icon: "üß©",
    level: "Senior",
    requirements: {
      type: "combination",
      languages: ["Brainfuck"],
      projectCount: 8,
      description: "Completa 8 proyectos en Brainfuck.",
    },
  },
  {
    id: "brainfuck-guru",
    name: "Gur√∫ de Brainfuck",
    description: "Maestr√≠a excepcional en el arte de Brainfuck",
    icon: "üëë",
    level: "Master",
    requirements: {
      type: "combination",
      languages: ["Brainfuck"],
      projectCount: 12,
      description: "Completa 12 proyectos en Brainfuck y convi√©rtete en un verdadero maestro.",
    },
  },
  {
    id: "brainfuck-innovator",
    name: "Innovador de Brainfuck",
    description: "Creando soluciones innovadoras con Brainfuck",
    icon: "üí°",
    level: "Master",
    requirements: {
      type: "combination",
      languages: ["Brainfuck"],
      projectCount: 15,
      description: "Completa 15 proyectos en Brainfuck, demostrando verdadera innovaci√≥n.",
    },
  },
]

// Function to check if a badge is unlocked based on user's achievements and projects
export const checkBadgeUnlocked = (
  badge: Badge,
  achievements: any[],
  completedProjects: any[],
  streakDays: number,
): { unlocked: boolean; progress: number } => {
  const { requirements } = badge
  let unlocked = false
  let progress = 0

  switch (requirements.type) {
    case "achievements":
      if (requirements.specificIds) {
        // Check if specific achievements are unlocked
        const unlockedCount = requirements.specificIds.filter((id) =>
          achievements.some((a) => a.id === id && a.completed),
        ).length
        progress = Math.min(Math.floor((unlockedCount / requirements.specificIds.length) * 100), 100)
        unlocked = unlockedCount === requirements.specificIds.length
      } else if (requirements.count) {
        // Check if a certain number of achievements are unlocked
        const unlockedCount = achievements.filter((a) => a.completed).length
        progress = Math.min(Math.floor((unlockedCount / requirements.count) * 100), 100)
        unlocked = unlockedCount >= requirements.count
      }
      break

    case "projects":
      const relevantProjects = completedProjects.filter((project) => {
        if (badge.level === "Student") {
          return project.level === "Student"
        } else if (badge.level === "Trainee") {
          return ["Student", "Trainee"].includes(project.level)
        } else if (badge.level === "Junior") {
          return ["Student", "Trainee", "Junior"].includes(project.level)
        } else if (badge.level === "Senior") {
          return ["Junior", "Senior"].includes(project.level)
        } else {
          return true // Master level considers all projects
        }
      })

      if (requirements.projectCount) {
        progress = Math.min(Math.floor((relevantProjects.length / requirements.projectCount) * 100), 100)
        unlocked = relevantProjects.length >= requirements.projectCount
      }
      break

    case "languages":
      const uniqueLanguages = new Set<string>()
      completedProjects.forEach((project) => {
        project.technologies.forEach((tech: string) => uniqueLanguages.add(tech))
      })

      if (requirements.count) {
        progress = Math.min(Math.floor((uniqueLanguages.size / requirements.count) * 100), 100)
        unlocked = uniqueLanguages.size >= requirements.count
      }
      break

    case "frameworks":
      const uniqueFrameworks = new Set<string>()
      completedProjects.forEach((project) => {
        project.frameworks.forEach((framework: string) => uniqueFrameworks.add(framework))
      })

      if (requirements.count) {
        progress = Math.min(Math.floor((uniqueFrameworks.size / requirements.count) * 100), 100)
        unlocked = uniqueFrameworks.size >= requirements.count
      }
      break

    case "combination":
      let combinationProgress = 0
      let combinationTotal = 0
      let combinationUnlocked = true

      // Check language requirements
      if (requirements.languages && requirements.count) {
        const languageCounts: Record<string, number> = {}
        completedProjects.forEach((project) => {
          project.technologies.forEach((tech: string) => {
            if (requirements.languages!.includes(tech)) {
              languageCounts[tech] = (languageCounts[tech] || 0) + 1
            }
          })
        })

        const languagesWithEnoughProjects = Object.keys(languageCounts).filter(
          (lang) => languageCounts[lang] >= (requirements.projectCount || 1),
        ).length

        combinationProgress += languagesWithEnoughProjects
        combinationTotal += requirements.count
        combinationUnlocked = combinationUnlocked && languagesWithEnoughProjects >= requirements.count
      }

      // Check for specific language with project count
      if (requirements.languages && requirements.languages.length === 1 && requirements.projectCount) {
        const language = requirements.languages[0]
        const projectsWithLanguage = completedProjects.filter((project) =>
          project.technologies.includes(language),
        ).length

        progress = Math.min(Math.floor((projectsWithLanguage / requirements.projectCount) * 100), 100)
        unlocked = projectsWithLanguage >= requirements.projectCount
        return { unlocked, progress }
      }

      // Check project count requirements
      if (requirements.projectCount && !requirements.languages) {
        combinationProgress += Math.min(completedProjects.length, requirements.projectCount)
        combinationTotal += requirements.projectCount
        combinationUnlocked = combinationUnlocked && completedProjects.length >= requirements.projectCount
      }

      // Check streak requirements
      if (requirements.streakDays) {
        combinationProgress += Math.min(streakDays, requirements.streakDays)
        combinationTotal += requirements.streakDays
        combinationUnlocked = combinationUnlocked && streakDays >= requirements.streakDays
      }

      progress = combinationTotal > 0 ? Math.min(Math.floor((combinationProgress / combinationTotal) * 100), 100) : 0
      unlocked = combinationUnlocked
      break

    case "streak":
      if (requirements.streakDays) {
        progress = Math.min(Math.floor((streakDays / requirements.streakDays) * 100), 100)
        unlocked = streakDays >= requirements.streakDays
      }
      break
  }

  return { unlocked, progress }
}
